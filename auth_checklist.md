# Проектное задание шестого спринта

- [ ] Перед тем, как приступить к разработке, нужно составить план действий и сдать на проверку наставнику:
    - из чего будет состоять сервис,
    - каким будет его API,
    - какие хранилища он будет использовать 
    - какой будет его схема данных.

## Критерии готовности

### Анонимный пользователь может:
- [ ] Создать аккаунт, если выбранный email ещё не зарегистрирован в системе
- [ ] Зарегистрироваться через социальную сеть
- [ ] Войти в свой аккаунт по логину и паролю (обмен логина и пароля на пару токенов: JWT-access токен и refresh токен)
- [ ] Войти в свой аккаунт через социальную сеть с использованием OAuth 2.0

### Авторизированный пользователь может:
- [ ] Обновить access-токен
- [ ] Посмотреть личные данные
- [ ] Изменить свои личные данные — логин или пароль (без подтверждений по email)
- [ ] Просмотреть историю входов в аккаунт
- [ ] Посмотреть связанные аккаунты в социальных сетях
- [ ] Открепить аккаунт социальной сети
- [ ] Выйти из аккаунта

### Администратор может
- [ ] Управлять ролями через CRUD:
    - создание роли,
    - удаление роли,
    - изменение роли,
    - просмотр всех ролей
- [ ] Назначить пользователю роль
- [ ] Отобрать у пользователя роль
- [ ] Получить список прав пользователя

### Из консоли можно:
- [ ] Создать суперпользователя

### Дополнительный чек-лист
- [ ] Описание на OpenAPI
- [ ] Обработка ошибок:
    - истекший токен
    - токен с неверной подписью
    - имя пользователя занято
- [ ] ETL для фильмов: добавить метку для организации ограничений
- [ ] Покрытие функциональными тестами

## Архитектура
- [ ] Безопасные библиотеки шифрования: pycryptodomex, cryptography,  pynacl
- [ ] Двухфакторная аутентификация TOTP
- [ ] Аутентификация с использованием JWT-токенов (не cookie)
- [ ] Хранение данных пользователя в разных таблицах Postgres:
    Персональные данные:

        id,
        login,
        hash(password),
        first_name,
        last_name,
        email

    Служебная информация:

        id,
        user_id(PrimaryKey),
        is_superuser,
        role(PrimaryKey),
        user_agent,
        allowed_agents,
        last_login,
        created_at,
        history

    Роли:

        id,
        role_name,
        permission_set
- [ ] База данных для хранения невалидных токенов Redis
    key=user_id,
    value=access-токен,
    expire=<время жизни access-токена>
- [ ] Структура приложения FastAPI аналогичная предыдущему спринту
